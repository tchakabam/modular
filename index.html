<html>

	<head>

		<script type="text/javascript" src="./modular.this.js"></script>

		<link rel="stylesheet" href="style.css">

		<style>

		</style>
	</head>

	<body>

		<!--<div id="ui"></div>-->

		<canvas width="960" height="100" id="canvas"></canvas>

		<svg width="960" height="600" id="ui"></svg>

		<script type="text/javascript">
			
			function start() {
				var osc = new modular.Oscillator(500);
				//var osc2 = new modular.Oscillator(240);
				var lfo = new modular.Oscillator(400);
				//lfo.name = 'lfo0';
				var gain = window.gain = new modular.Gain();

				modular.Context.setUIElement('ui');

				modular.Nodule.patch(lfo, osc, 'frequency');

				modular.Nodule.patch(osc, gain);
				//modular.Nodule.patch(osc2, gain);

				gain.knob('gain').value = 0.0;

				modular.Context.patchToDevice(gain, 1.0);

				modular.Context.refreshUI();

				gain.knob('gain').value = 1.0;
			}

			function testKnob() {

				var c = document.getElementById("canvas");
				var canvasCtx = c.getContext("2d");

				var audioCtx = modular.Context.getOrCreateDefaultAudioContext();
				var analyser = audioCtx.createAnalyser();

				var knob = window.knob = new modular.Knob();

				

				// create Oscillator node
				var oscillator = audioCtx.createOscillator();

				oscillator.type = 'square';
				oscillator.frequency.value = 3000; // value in hertz
				oscillator.start();

				oscillator.connect(audioCtx.destination);

				knob.drive(oscillator.frequency);

				knob.drive(analyser);

				analyser.fftSize = 2048;
				var bufferLength = analyser.fftSize;
				var dataArray = new Uint8Array(bufferLength);
				analyser.getByteTimeDomainData(dataArray);

				var WIDTH = 960;
				var HEIGHT = 100;

				function draw() {

				      drawVisual = requestAnimationFrame(draw);

				      analyser.getByteTimeDomainData(dataArray);

				      canvasCtx.fillStyle = 'rgb(200, 200, 200)';
				      canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);

				      canvasCtx.lineWidth = 2;
				      canvasCtx.strokeStyle = 'rgb(0, 0, 0)';

				      canvasCtx.beginPath();

				      var sliceWidth = WIDTH * 1.0 / bufferLength;
				      var x = 0;

				      for(var i = 0; i < bufferLength; i++) {
				   
				        var v = dataArray[i] / 128.0;
				        var y = v * HEIGHT/2;

				        if(i === 0) {
				          canvasCtx.moveTo(x, y);
				        } else {
				          canvasCtx.lineTo(x, y);
				        }

				        x += sliceWidth;
				      }

				      canvasCtx.lineTo(canvas.width, canvas.height/2);
				      canvasCtx.stroke();
				    };

				    draw();
			}

			/*
			function test() {
				var AudioContext = window.AudioContext || window.webkitAudioContext;

				var audioCtx = new AudioContext();

				// create an normal oscillator to make sound
				var oscillator = audioCtx.createOscillator();

				// create a second oscillator that will be used as an LFO (Low-frequency
				// oscillator), and will control a parameter
				var lfo = audioCtx.createOscillator();

				// set the frequency of the second oscillator to a low number
				lfo.frequency.value = 2.0; // 2Hz: two oscillations par second

				// create a gain whose gain AudioParam will be controlled by the LFO
				var gain = audioCtx.createGain();

				// connect the LFO to the gain AudioParam. This means the value of the LFO
				// will not produce any audio, but will change the value of the gain instead
				lfo.connect(gain.gain);

				// connect the oscillator that will produce audio to the gain
				oscillator.connect(gain);

				// connect the gain to the destination so we hear sound
				gain.connect(audioCtx.destination);

				// start the oscillator that will produce audio
				oscillator.start();

				// start the oscillator that will modify the gain value
				lfo.start();				
			}
			*/

		</script>
		
	</body>

</html>